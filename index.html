<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Making music with JavaScript and Gamepads</title>

		<meta name="description" content="Making music with JavaScript and Gamepads - a presentation held at reject.js 2013">
		<meta name="author" content="Jan Monschke">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">
		<link rel="stylesheet" href="css/custom.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div id="source-info"></div>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Making music with JavaScript and Gamepads</h1>
					<hr />
					<h3>Reject.js 2013</h3>
					<h4 class="fragment" class="highlight"><a href="http://2012.jsconf.eu/speaker/2012/08/24/javascript-is-the-new-punk-rock.html">(inspiration)</a></h4>
				</section>

				<section>
					<h2>whoami</h2>
					<ul>
						<p>Jan Monschke</p>
						<p><a href="https://twitter.com/thedeftone">@thedeftone</a></p>
						<p><a href="https://github.com/janmonschke">github.com/janmonschke</a></p>
						<p><a href="http://janmonschke.com">janmonschke.com</a></p>
					</ul>
				</section>

				<section>
					<h2>What to expect</h2>
					<p class="fragment">Web Audio API</p>
					<p class="fragment">+</p>
					<p class="fragment">Gamepad API</p>
					<p class="fragment">=</p>
					<p class="fragment"><span class="highlight"><3 *</span></p>
					<p class="fragment"><small><span class="highlight">*</span> both are drafts, examples only work in Chrome for now</small></p>

					<aside class="notes">
						bleeding edge, examples may outdate fast, for sake of simplicity Chrome only for now, sorry FF :(
					</aside>

				</section>

				<section>
					<h2>Web Audio API</h2>

					<ul class="spaced">
						<li class="fragment">low-level access to all things audio</li>
						<li class="fragment">create sounds</li>
						<li class="fragment">manipulate sounds (filters)</li>
						<li class="fragment">time sounds precisely</li>
					</ul>

					<aside class="notes">
						<p>create: literally! create sounds from waves</p>
						<p>manipulate: a rich api to create custom filters easily</p>
						<p>precision: timing is everything when dealing with more than one sound</p>
						<p>Who feels comfortable with his knowledge about the physical basics of audio?</p>
					</aside>

				</section>

				<section>
					<h2>What is sound?</h2>

					<blockquote>"Sound is a mechanical wave that is an oscillation of pressure transmitted through some medium, composed of frequencies within the range of hearing."</blockquote>

					<aside class="notes">
						<p>I just want to get the basics right.</p>
						<p>when I stomp my feet, a pressure wave is created that oscillates and wanders through the ear into your ears</p>
					</aside>

				</section>

				<section>

					<h2>How does sound look like?</h2>
					<img src="images/sinewave.gif" data-source="http://televandalist.com/post/49335582926/61-hertz-sine-wave-tone-at-60fps">

					<p>a 61 Hertz tone in slow motion</p>

					<aside class="notes">
						<p>the speakers in this room are right now doing exactly the same</p>
						<p>we can see the sine movement</p>
						When contrast is too low: CTRL + ALT + CMD + 8 to the rescue
					</aside>
				</section>

				<section>
					<h2>Timing</h2>

					<ul class="spaced">
						<li>Timing is key!</li>
						<li class="fragment">before: setTimeout / requestAnimationFrame</li>
						<li class="fragment">lots of offset-calculations</li>
						<li class="fragment">inaccurate</li>
					</ul>

					<aside class="notes">
						<p>timing beats, songs, bits of songs</p>
						<p>everyone hears that somethings's wrong in a song when beats are off just for some miliseconds </p>
						<p>professional musicians even sometimes complain about delays on stage</p>
						<p>scientific fact: people can adopt to delays, when it's stable ;)</p>
						<p></p>
					</aside>
				</section>

				<section>
					<h2>Timing in Web Audio</h2>

					<ul class="spaced">
						<li>Timing is relative to the current context!</li>
						<li class="fragment"><pre><code>context.currentTime // -> time bar in seconds</code></pre></li>
					</ul>

					<img src="images/nyancat.gif" class="fragment">

					<aside class="notes">
						<p>context.currentTime is like a time bar, it starts once you play the first tune and will then go on forever...</p>

					</aside>
				</section>

				<section>
					<h2>Timing in Web Audio</h2>
					<p>Let's start a buffer in 2 seconds</p>

					<pre class="fragment"><code>
	sourceNode.start(context.currentTime + 2);
					</code></pre>


					<pre class="fragment"><code>
	sourceNode.start(when, offset, duration); // ouh yeah
					</code></pre>

					<p class="fragment">
						<button id="playWith2sdelay">Play with 2s delay</button>
						<button id="playWith43soffset">Play with some offset</button>
						<button id="stopIn2s">Stop in 2s</button>
					</p>

					<aside class="notes">
						<p>when: start at that time on the time bar, if < currentTime then starts immediately;; offset: offset in the current buffer</p>
						<p>same goes for the stop method</p>
						<p>imagein how hard it would be to code that with settimeout, setinterval</p>
						<p>NO MORE SETTIMEOUT!!!!</p>
					</aside>
				</section>	

				<section>
					<h2>Timing in Web Audio: Future Value(s)</h2>

					<p>The API even allows to set values in the future:</p>

					<pre class="fragment"><code>
	// set the gain to .2 in 5 seconds
	sourceNode.gain.setValueAtTime(.2, context.currentTime + 5);
					</code></pre>

					<pre class="fragment"><code>
	// fade out
	sourceNode.linearRampToValueAtTime(0, context.currentTime + 5);
					</code></pre>

					<p class="fragment">
						<button id="setvalueattime">Set gain to .2 in five seconds</button>
					</p>

					<aside class="notes">
						<p>gain = volume</p>
						<p>linear, exponential, event own curves, but too complex to show now</p>
					</aside>

				</section>

				<section>
					<h2>Demos</h2>

					<p><a href="/beatinator" class="fragment">The hello world of Web Audio API - a drum machine</a></p>

					<p><a href="http://labs.dinahmoe.com/plink/" class="fragment">Plink!</a></p>

					<p><a href="http://www.jamwithchrome.com/" class="fragment">Jam with chrome</a></p>

					<aside class="notes">
						<p>if you want to get started with the web audio API, I suggest you start by implementing a drum machine, it's not too hard and you'll get familiar with the timing system, nodes and buffers very easily</p>
						<p>the current implementation uses buffers, but synthetic sounds are possible, too</p>


					</aside>

				</section>

				<section>
					<h2>Let's talk about Gamepads and Gaming</h2>

					<ul class="spaced">
						<li class="fragment">More complex games are written in JS (Canvas, WebGL)</li>
						<li class="fragment">Controlling games: W, A, S, D or arrows + mouse + keys</li>
						<li class="fragment">Problem: digital vs. analogue</li>
					</ul>

					<aside class="notes">
						<ul>
							<li>digital: only zero and one values when pressing a buttons</li>
							<li>analogue: values between zero and one, where zero is minimum and one is maximum</li>
							<li>granular intensity, axes on buttons</li>
							<li>e.g. speed of character </li>
							<li>mocking is possible by adjusting speed based on time a button is pressed</li>
						</ul>
					</aside>
				</section>

				<section>
					<h2>Gamepad API</h2>

					<p class="big">Use all your favorite Gamepads with a standardized API!</p>

					<p class="big">Yey! :)</p>

				</section>

				<section>
					<h2>Gamepad API 101</h2>

					<pre class="fragment"><code>
	var gamepads = navigator.webkitGetGamepads()
					</code></pre>
					<pre class="fragment"><code>
	var firstPad = gamepads[0];
					</code></pre>
					<pre class="fragment"><code>
	firstPad.buttons; // -> Array[17]
					</code></pre>
					<pre class="fragment"><code>
	firstPad.buttons[0]; // -> 0
					</code></pre>

					<aside class="notes">
						<ul>
							<li>Short reminder: again the examples only work in chrome/webkit</li>
							<li>Wow, what? 17 Buttons?</li>
							<li>aaand we're digital again -> buttons are digital</li>
						</ul>
					</aside>

				</section>


				<section>
					<h2>Gamepad API 101</h2>

					<pre class="fragment"><code>
	firstPad.axes; // -> Array[4]
					</code></pre>

					<pre class="fragment"><code>
	firstPad.axes[0]; // -> 0.38765
					</code></pre>

					<aside class="notes">
						<ul>
							<li>Axes range from -1 to 1</li>
							<li>this is where you get the precision</li>
						</ul>
					</aside>

				</section>

				<section>
					<h2>But how am I supposed to know which button has which index?</h2>

					<p class="fragment">It's standardized, look:</p>
					<img class="fragment" src="images/gamepad_diagram.png" data-source="http://www.html5rocks.com/en/tutorials/doodles/gamepad/">

					<aside class="notes">
						<p>Zoom the image when presenting!!</p>
						<ul>
							<li>It's not possible to recall the arrangement, are they the same index for all gamepads out there? Yes!</li>
							<li>It doesn't matter which gamepad you use (PS3, XBox etc)</li>
						</ul>
					</aside>
				</section>

				<section>
					<section>
						<h2>Did you notice something?</h2>
					</section>
					<section>

						<pre><code>
	var gamepads = navigator.webkitGetGamepads()

	var firstPad = gamepads[0];

	firstPad.buttons; // -> Array[17]

	firstPad.buttons[0]; // -> 0
						</code></pre>
					</section>

					<section>

						<h2>It's not event-driven!</h2>

						<ul>
							<li class="fragment">API is designed for usage in games</li>
							<li class="fragment">Games often have an update()-loop where they poll gamepad states</li>
							<li class="fragment">Events <strong>may</strong> be added in the future</li>
						</ul>

						<aside class="notes">
							<p>Not event driven? But why? How? What?</p>
							<p>Polling for available gamepads and each of their states necessary</p>
							<p></p>
							<p>Not common for web developers but easy to adopt to</p>
						</aside>

					</section>
				</section>

				<section>
					<h2>Let's play</h2>

					<p><a href="gamepad-demo.html">Gamepad demo</a></p>
										
					<p class="fragment"><a href="http://www.google.com/doodles/hurdles-2012">An actual game ;)</a></p>
				</section>

				<section>
					<h2>Let's play some music</h2>

					<p>show a demo that plays a sound and the gamepad can manipulate it (use demo from HTW hackaday) and add sounds on button press, change playbackrate with one of the triggers</p>

					<aside>
						Let's combine the two APIs for a first time :)
					</aside>
				</section>

				<section>
					<h2>Let's talk about Gamepads again!</h2>

					<p class="fragment">What exactly qualifies as a Gamepad?</p>
					<blockquote class="fragment">"If it has a button, it is a Gamepad!<small>&trade;</small>"<span class="highlight">*</span></blockquote>
					<p class="fragment"><small><span class="highlight">*</span> (assuming that your browser knows how to interface it)</small></p>

					<aside class="notes">
						<p>Wasn't that fun?</p>
						<p>Unluckily gamepads like this one don't really qualify for music production, so what are the alternatives?</p>
					</aside>

				</section>

				<section>
					<h2>Introducing: DJ Hero turntable</h2>

					<img src="images/djherogamepad.jpg" data-source="http://www.wiids.co.uk/wp-content/uploads/2009/06/dj-hero-controller-010.jpg">

					<aside class="notes">
						<p>DJ Hero is Guitar Hero with turntables</p>
						<p>looks way more suited to music making, doesn't it? DESCRIBE BUTTONS!</p>
						<p>The best part about it: the gamepad api is capable of dealing with it!</p>
						<p>Let's see what we can do with it :)</p>
					</aside>
				</section>

				<section>
					<h2>dj.js</h2>

					<p>Insert simple dj.js demo here, first with one song, then with two songs and two turntables, where I try to mix two songs....</p>

					<aside class="notes">
						<p>DISCLAIMER: no scratching!!!!! Will explain later!</p>
						<p>explain functionality: gain, effects, cue-ing, tunrtable(-lock)</p>
						<p>first time dj performance in front of anyone else but the wasps in my room :D</p>
					</aside>
				</section>

				<section>
					<h2>API problems (Web Audio API)</h2>
				</section>

				<section>
					<h2>API problems (Gamepad API)</h2>

				</section>

				<section>
					<h2>One more thing!</h2>

					<aside class="notes">
						<p>Unwrap the guitar!</p>
						<p>Ask who has played guitar hero before</p>
						<p>Ask for volunteer ;)</p>
					</aside>
				</section>

				<section>
					<h2>guitarhero.js</h2>

					<p>add the guitar hero clone</p>

					<aside class="notes">
						<p>For some reason the Rockband drumkit didn't work, would've loved to have a band perform on stage ;)</p>
					</aside>
				</section>

				<section>
					<h2>Further Readings</h2>

					<ul>
						<li></li>
					</ul>
				</section>

				<section>
					<h1>THX so much for your attention!</h1>
				</section>

				<section>
					<h1>You we're a great audience!</h1>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/sources/sources.js', async: true }
				]
			});

			var context = new webkitAudioContext();
			var source = null;

			var buffers = {};

			var loadBuffer = function(location, bufferName){
				var xhr = new XMLHttpRequest();
		    xhr.open('GET', location, true);
		    xhr.responseType = 'arraybuffer';
		    xhr.onload = function(e) {
		      context.decodeAudioData(xhr.response, function(buffer) {
		      	buffers[bufferName] = buffer;
		      });
		    };
		    xhr.send();
			};

			loadBuffer('mixer/songs/rick.mp3', 'rick');
			loadBuffer('mixer/songs/wearetherejects.mp3', 'rejects');

			var playBuffer = function(bufferName, when, offset, duration){
				if(source) source.stop(0);
				source = context.createBufferSource();
		    source.buffer = buffers[bufferName];
		    source.connect(context.destination);
		    source.start(when + context.currentTime, offset, duration);
			};

			document.getElementById('playWith2sdelay').addEventListener('click', function(){
				playBuffer('rick', 2, 0, 15);
			});

			document.getElementById('playWith43soffset').addEventListener('click', function(){
				playBuffer('rick', 0, 43.9, 10);
			});

			document.getElementById('stopIn2s').addEventListener('click', function(){
				source.stop(context.currentTime + 2);
			});

			document.getElementById('setvalueattime').addEventListener('click', function(){
				playBuffer('rejects', 0, 0, 10);
				source.gain.value = 2;
				source.gain.setValueAtTime(.5, context.currentTime + 5);
			});

		</script>

	</body>
</html>
